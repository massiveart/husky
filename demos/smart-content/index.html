<!doctype html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Smart Content Demo</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="stylesheet" href="../../dist/husky.min.css">
    <style type="text/css">
        h1 {
            padding: 20px 0 0 50px;
        }
        #smart-content,
        #smart-content2 {
            padding: 50px 0 0 50px;
        }
        .fixed-width {
            width: 820px;
        }
        #setConfigs {
            margin: 10px 0 0 50px;
        }
    </style>
</head>
<body>
<h1>Smart Content Husky Demo</h1>
<button id="setConfigs">Set new configs to smart-content-1</button>
<div class="container">
    <div class="grid">
        <div class="grid-row">
            <div class="grid-col-6 fixed-width">
                <div id="smart-content"></div>
            </div>
        </div>
        <div class="grid-row">
            <div class="grid-col-6 fixed-width m-top-20">
                <div id="smart-content2"></div>
            </div>
        </div>
    </div>
</div>

<script src="../js/sinon.js"></script>
<script src="../js/jquery.js"></script>
<script src="../js/require.js"></script>
<script type="text/javascript">
    require.config({
        baseUrl: '../../'
    });

    require(['lib/husky'], function(Husky) {
        'use strict';

        var fakeServer = sinon.fakeServer.create();
        fakeServer.respondWith('GET', '/smartcontent?dataSource=&includeSubFolders=false&category=0&tags=&sortBy=0&sortMethod=asc&presentAs=0&limitResult=0', [200, { 'Content-Type': 'application/json' },
            '{"_embedded": [{"id": 1, "name": "Produkt A"}, {"id": 2, "name": "Produkt B"}, {"id": 3, "name": "Produkt C"}, {"id": 4, "name": "Produkt D"}, {"id": 5, "name": "Produkt E"}, {"id": 6, "name": "Produkt F"}, {"id": 7, "name": "Produkt G"}, {"id": 8, "name": "Produkt H"}, {"id": 9, "name": "Produkt I"}, {"id": 10, "name": "Produkt J"}]}'
        ]);
        fakeServer.respondWith('GET', '/smartcontent?dataSource=/home&includeSubFolders=false&category=&tags=&sortBy=&sortMethod=asc&presentAs=&limitResult=', [200, { 'Content-Type': 'application/json' },
            '{"_embedded": [{"id": 1, "name": "Produkt X"}, {"id": 2, "name": "Produkt Y"}, {"id": 3, "name": "Produkt Z"}, {"id": 4, "name": "Produkt Q"}]}'
        ]);

        fakeServer.respondWith('GET', '/smartcontent2?dataSource=&includeSubFolders=false&category=0&tags=&sortBy=0&sortMethod=asc&presentAs=0&limitResult=0', [200, { 'Content-Type': 'application/json' },
            '{"_embedded": [{"id": 1, "name": "Page A"}, {"id": 2, "name": "Page B"}, {"id": 3, "name": "Page C"}, {"id": 4, "name": "Page D"}, {"id": 5, "name": "Page E"}, {"id": 6, "name": "Page F"}, {"id": 7, "name": "Page G"}, {"id": 8, "name": "Page H"}, {"id": 9, "name": "Page I"}, {"id": 10, "name": "Page J"}]}'
        ]);
        fakeServer.respondWith('GET', '/smartcontent2?dataSource=/products&includeSubFolders=false&category=&tags=&sortBy=&sortMethod=asc&presentAs=&limitResult=', [200, { 'Content-Type': 'application/json' },
            '{"_embedded": [{"id": 1, "name": "Page X"}, {"id": 2, "name": "Page Y"}, {"id": 3, "name": "Page Z"}, {"id": 4, "name": "Page Q"}]}'
        ]);

        var app = Husky({ debug: { enable: true }}),
                _ = app.sandbox.util._;

        app.start([{
            name: 'smart-content@husky',
            options: {
                el: '#smart-content',
                url: '/smartcontent',
                instanceName: 'smartcontent1',
                categories: [{id: 1, name: 'New products'},
                             {id: 2, name: 'Old products'},
                             {id: 3, name: 'technical products'}],
                sortBy: [{id: 1, name: 'Description'},
                         {id: 2, name: 'Name'},
                         {id: 3, name: 'Price'}],
                presentAs: [{id: 1, name: '2-columns with pictures'},
                            {id: 2, name: '1-column with pictures'},
                            {id: 3, name: 'only pictures'}],
                translations: {
                    configureSmartContent: 'Overlay for Smart-content 1'
                }
            }
            },
            {
                name: 'smart-content@husky',
                options: {
                    el: '#smart-content2',
                    url: '/smartcontent2',
                    instanceName: 'smartcontent2',
                    subFoldersDisabled: true,
                    categories: [],
                    externalConfigs: true,
                    sortBy: [{id: 4, name: 'First name'},
                        {id: 5, name: 'Last name'},
                        {id: 6, name: 'Middle name'}],
                    presentAs: [],
                    translations: {
                        configureSmartContent: 'Overlay for Smart-content 2'
                    }
                }
            }]).then(function() {
            app.logger.log('Aura started...');

            setTimeout(function() {
                app.sandbox.emit('husky.smart-content.smartcontent2.external-configs', {
                    tagsDisabled: true
                });
            }, 500);

            app.sandbox.on('husky.smart-content.smartcontent1.data-request', function() {
               setTimeout(function() {
                   fakeServer.respond();
               }, 100);
            });
            app.sandbox.on('husky.smart-content.smartcontent2.data-request', function() {
                setTimeout(function() {
                    fakeServer.respond();
                }, 100);
            });

            $('#setConfigs').on('click', function() {
               app.sandbox.emit('husky.smart-content.smartcontent1.set-configs', {
                   dataSource: '/newdatasource',
                   subFoldersDisabled: true,
                   categories: [{id: 44, name: 'New Category 1'}, {id: 48, name: 'New Category 2'}],
                   preSelectedCategory: 48
               });
            });
        });
    });
</script>

</body>
</html>
