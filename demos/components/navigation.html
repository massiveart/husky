<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="stylesheet" href="../../.tmp/husky.css">
</head>
<body>
    <div id="main">
        <div id="navigation"></div>
        <button id="load-content" style="position:absolute; right:0; top:0;">Load Content</button>
    </div>

    <script src="../../node_modules/sinon/pkg/sinon.js"></script>
    <script src="../../bower_components/jquery/jquery.js"></script>

    <script src="../../js/husky.js"></script>
    <script src="../../js/modules/util.js"></script>
    <script src="../../js/modules/ui.navigation.js"></script>

    <script type="text/javascript">
        Husky.DEBUG = true;

        var fakeServer;
        $(document).ready(function() {
            fakeServer = sinon.fakeServer.create();

            fakeServer.respondWith('GET', '/navigation', [200, { 'Content-Type': 'application/json' },
                '{"title":"Root","hasSub":true,"id":"51f258be2e45b","header":{ "title":"Ivoclar", "logo": "http://lorempixel.com/32/32/nature/" },"sub":{"items":[{"title":"Portals","icon":"portals","hasSub":true,"id":"52f258bc2e47f","action":"/navigation/portals"},{"title":"Settings","icon":"settings","hasSub":true,"id":"51f258be2e47f","sub":{"items":[{"title":"Translate","icon":"translate","hasSub":"false","id":"51f258be2e49a","action":"/settings/translates"}]}}]}}'
            ]);

            fakeServer.respondWith('GET', '/navigation/portals', [200, { 'Content-Type': 'application/json' },
                '{"header": { "title":"Portals" }, "sub":{"items":[{"title":"Products","icon":"settings","id":"products","hasSub":true,"action":"/portals/products"}, {"title":"Portal 1","icon":"settings","id":"portal_1","hasSub":false,"action":"/portals/products","type":"content"}]}}'
            ]);

            fakeServer.respondWith('GET', '/settings/translates', [200, { 'Content-Type': 'application/json' },
                '{"sub":{"items":[{"title":"Deutschland","id":"de","hasSub":true,"action":"/settings/translates/de"}]}}'
            ]);

            fakeServer.respondWith('GET', '/settings/translates/de', [200, { 'Content-Type': 'application/json' },
                '{"sub":{"items":[{"title":"Items","id":"items","hasSub":true,"action":"/settings/translates/de/items"}]}}'
            ]);

            fakeServer.respondWith('GET', '/settings/translates/de/items', [200, { 'Content-Type': 'application/json' },
                '{"sub":{"items":[{"title":"Item","id":"item","hasSub":true,"action":"/settings/translates/de/item/sub"}]}}'
            ]);

            fakeServer.respondWith('GET', '/settings/translates/de/item/sub', [200, { 'Content-Type': 'application/json' },
                '{"sub":{"items":[{"title":"Sub","id":"sub","hasSub":false,"type":"content","action":"de"}]}}'
            ]);


            fakeServer.respondWith('GET', '/portals/products', [200, { 'Content-Type': 'application/json' },
                '{"sub":{"items":[{"title":"Produkt 1","id":"product_1","hasSub":true,"action":"/portals/products/product_1"}]}}'
            ]);

            fakeServer.respondWith('GET', '/portals/products/product_1', [200, { 'Content-Type': 'application/json' },
                '{"sub":{"items":[{"title":"Produkt 2","id":"product_2","hasSub":false,"type":"content","action":"/portals/products/product_1/content"}]}}'
            ]);

            var navigation = $('#navigation').huskyNavigation({
                url: '/navigation',
                collapse: true
            });

            navigation.data('Husky.Ui.Navigation').on('navigation:item:selected', function(item) {
                setTimeout(function() {
                    fakeServer.respond();
                }, 1000);
            });

            navigation.data('Husky.Ui.Navigation').on('navigation:item:content:show', function(item){
                console.log('navigation:item:content:show');

                navigation.data('Husky.Ui.Navigation').trigger('navigation:item:column:show', {
                    data: {
                            "displayOption": "content", 
                            "sub": {
                                        "items":[{
                                                    "title":"Details",
                                                    "id":"details",
                                                    "hasSub":false,
                                                    "type":"content",
                                                    "action":"/"
                                                },
                                                {
                                                    "title":"Settings",
                                                    "id":"settings",
                                                    "hasSub":false,
                                                    "action":"/"
                                                }]
                                    }
                    }
                });
            });


            $('#load-content').on('click', function() {
                navigation.data('Husky.Ui.Navigation').trigger('navigation:item:column:show', {
                    data: {
                            "displayOption": "content", 
                            "sub": {
                                        "items":[{
                                                    "title":"Details",
                                                    "id":"details",
                                                    "hasSub":false,
                                                    "type":"content",
                                                    "action":"/"
                                                },
                                                {
                                                    "title":"Settings",
                                                    "id":"settings",
                                                    "hasSub":false,
                                                    "action":"/"
                                                }]
                                    }
                    }
                });
            }.bind(this));

            fakeServer.respond();
        });
    </script>

</body>
</html>
