define("form/util",[],function(){"use strict";var e=["form","validation"];return{debugEnabled:!1,getFields:function(e){return $(e).find('input:not([data-form="false"], [type="submit"], [type="button"], [type="checkbox"], [type="radio"]), textarea:not([data-form="false"]), select:not([data-form="false"]), *[data-form="true"], *[data-type="collection"], *[contenteditable="true"]')},findGroupedFieldsBySelector:function(e,t){var n={},r;return $(e).find(t).each(function(e,t){r=$(t).data("mapper-property"),n[r]||(n[r]=[]),n[r].push(t)}),n},getCheckboxes:function(e){return this.findGroupedFieldsBySelector(e,'input[type="checkbox"]')},getRadios:function(e){return this.findGroupedFieldsBySelector(e,'input[type="radio"]')},parseData:function(e,t,n){var r=$(e);return this.buildOptions(r.data(),t,"",n)},buildOptions:function(t,n,r,i){r||(r=""),i||(i={});var s=$.extend({},i,{}),o=n+this.ucFirst(r);return $.each(t,function(t,r){var i=new RegExp("^"+o);i.test(t)&&$.inArray(t,e)===-1&&(t!==o?t=t.replace(i,""):t=t.replace(new RegExp("^"+n),""),t!==""&&(t=this.lcFirst(t),s[t]=r))}.bind(this)),s},isValueField:function(e){var t=$(e);return t.is("input, select, textarea, option, button")},isCheckbox:function(e){var t=$(e);return t.is(":checkbox")},getValue:function(e){var t=$(e);return this.isCheckbox(t)?t.prop("checked"):this.isValueField(t)?t.val():t.html()},setValue:function(e,t){var n=$(e);this.isCheckbox(n)?n.prop("checked",t):this.isValueField(n)?n.val(t):n.html(t)},debug:function(e,t,n){!this.debugEnabled||(e?t?n?console.log("Husky Validation:",e,t,n):console.log("Husky Validation:",e,t):console.log("Husky Validation:",e):console.log("Husky Validation"))},ucFirst:function(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)},lcFirst:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},startsWith:function(e,t){return e.indexOf(t)===0},print:function(e,t){t||(t=1);var n="",r="&nbsp;&nbsp;&nbsp;&nbsp;",i,s,o="",u=0;while(u<t)o+=r,u++;for(i in e)e.hasOwnProperty(i)&&(s=e[i],typeof s=="string"?this.isNumeric(s)?n+=o+i+": "+s+"; </br>":(s.length>7&&(s=s.substring(0,6)+" ..."),n+=o+i+": '"+s+"'; </br>"):n+=o+i+": { </br>"+o+r+print(s,t++)+"}");return n},isNumeric:function(e){return e.match(/-?\d+(.\d+)?/)}}}),define("form/element",["form/util"],function(e){"use strict";return function(t,n,r){var i={type:null,validationTrigger:"focusout",validationAddClasses:!0,validationAddClassesParent:!0,validationErrorClass:"husky-validate-error",validationClass:"husky-validate",validation:!0},s=["validation","validationTrigger","validationAddClasses","validationAddClassesParent","validationClass","validationErrorClass","validationSubmitEvent"],o,u={},a,f=null,l=null,c={initialize:function(){l=$.Deferred(),this.requireCounter=0,this.initialized=l.promise(),this.$el=$(t),this.$el.data("element",this),this.options=$.extend({},i,r),!this.options.validationAddClasses||this.$el.addClass(this.options.validationClass),!this.options.validation||c.initValidation.call(this)},resolveInitialization:function(){this.requireCounter--,this.requireCounter===0&&l.resolve()},initValidation:function(){c.bindValidationDomEvents.call(this),c.initValidators.call(this),c.initType.call(this)},bindValidationDomEvents:function(){var e=this.options.validationTrigger?this.options.validationTrigger:"";if(e===""||e==="none")return;this.$el.is("select")&&(e+=(new RegExp("change","i")).test(e)?"":" change"),e=e.replace(/^\s+/g,"").replace(/\s+$/g,""),this.$el.bind(e,this.validate.bind(this))},initValidators:function(){var t=function(t,r){this.requireCounter++,require(["validator/"+t],function(i){u[t]=new i(this.$el,n,this,r),e.debug("Element Validator",t,r),c.resolveInitialization.call(this)}.bind(this))}.bind(this);$.each(this.options,function(n,r){if(!!r&&$.inArray(n,s)===-1&&e.startsWith(n,"validation")){var i=e.lcFirst(n.replace("validation","")),o=e.buildOptions(this.options,"validation",i);t(i,o)}}.bind(this)),this.$el.attr("required")==="required"&&!u.required&&t("required",{required:!0}),!!this.$el.attr("min")&&!u.min&&t("min",{min:parseInt(this.$el.attr("min"),10)}),!!this.$el.attr("max")&&!u.max&&t("max",{max:parseInt(this.$el.attr("max"),10)}),!!this.$el.attr("pattern")&&!u.pattern&&t("regex",{regex:this.$el.attr("pattern")})},initType:function(){var t=function(t,r){this.requireCounter++,require(["type/"+t],function(i){a=new i(this.$el,r,n),a.initialized.then(function(){e.debug("Element Type",t,r),c.resolveInitialization.call(this)}.bind(this))}.bind(this))}.bind(this),r=e.buildOptions(this.options,"type"),i,s;this.options.type?i=this.options.type:this.$el.attr("type")?(s=this.$el.attr("type"),s==="email"?i="email":s==="url"?i="url":s==="number"?i="decimal":s==="date"?(i="date",!r.format||(r.format="d")):s==="time"?(i="date",!r.format||(r.format="t")):s==="datetime"?i="date":i="string"):i="string",t(i,r)},hasConstraints:function(){var e=!!a&&a.needsValidation(),t=Object.keys(u).length>0;return t||e},needsValidation:function(){return f!==e.getValue(this.$el)},reset:function(){var e=this.$el;!this.options.validationAddClassesParent||(e=e.parent()),e.removeClass(this.options.validationErrorClass)},setValid:function(e){o=e;if(!!this.options.validationAddClasses){c.reset.call(this);var t=this.$el;!this.options.validationAddClassesParent||(t=t.parent()),e||t.addClass(this.options.validationErrorClass)}}},h={validate:function(t){var n=!0,r=!1;return(t||c.needsValidation.call(this))&&c.hasConstraints.call(this)&&($.each(u,function(e,t){t.validate()||(n=!1)}),r=!0),!!a&&a.needsValidation()&&(a.validate()||(n=!1),r=!0),r===!0&&(n||e.debug("Field validate",n?"true":"false",this.$el),c.setValid.call(this,n)),n},update:function(){if(!c.hasConstraints.call(this))return!0;var t=!0;return $.each(u,function(e,n){n.update()||(t=!1)}),a!==null&&!a.validate()&&(t=!1),t||e.debug("Field validate",t?"true":"false",this.$el),c.setValid.call(this,t),t},isValid:function(){return o},updateConstraint:function(e,t){if(!($.inArray(e,Object.keys(u))>-1))throw"No constraint with name: "+e;u[e].updateConstraint(t),this.validate()},deleteConstraint:function(e){if(!($.inArray(e,Object.keys(u))>-1))throw"No constraint with name: "+e;delete u[e],this.validate(!0)},addConstraint:function(e,t){if($.inArray(e,Object.keys(u))!==-1)throw"Constraint with name: "+e+" already exists";require(["validator/"+e],function(r){u[e]=new r(this.$el,n,this,t)}.bind(this))},hasConstraint:function(e){return!!u[e]},getConstraint:function(e){return this.hasConstraint(e)?u[e]:!1},fieldAdded:function(e){$.each(u,function(t,n){n.fieldAdded(e)})},fieldRemoved:function(e){$.each(u,function(t,n){n.fieldRemoved(e)})},setValue:function(e){var t=$.Deferred(),n;return this.initialized.then(function(){n=a.setValue(e),n?n.then(function(){t.resolve()}):t.resolve()}.bind(this)),t.promise()},getValue:function(e){return a.getValue(e)},getType:function(){return a}};return c.initialize.call(h),h}}),define("form/elementGroup",[],function(){"use strict";var e=function(e,t){e.forEach(function(e){t.forEach(function(t){e.$el.val()===t&&e.$el.prop("checked",!0)})})},t=function(e,t){for(var n=-1;++n<e.length;)if(e[n].$el.val()===t){e[n].$el.prop("checked",!0);return}};return function(n,r){var i={getValue:function(){var e=[];n.forEach(function(t){t.$el.is(":checked")&&e.push(t.$el.val())});if(!!r){if(e.length>1)throw new Error("Single value element group cannot return more than one value");return e[0]}return e},setValue:function(i){if(!!r&&!!$.isArray(i))throw new Error("Single value element cannot be set to an array value");if(!r&&!$.isArray(i))throw new Error("Field with multiple values cannot be set to a single value");$.isArray(i)?e.call(this,n,i):t.call(this,n,i)}};return n.forEach(function(e){e.$el.data("elementGroup",i)}),i}}),define("form/validation",["form/util"],function(e){"use strict";return function(t){var n,r={initialize:function(){r.bindValidationDomEvents.call(this),e.debug("INIT Validation")},bindValidationDomEvents:function(){!t.options.validationSubmitEvent||t.$el.on("submit",function(){return t.validation.validate()}.bind(this))},setValid:function(e){n=e}},i={validate:function(n){var i=!0;return $.each(t.elements,function(e,t){t.validate(n)||(i=!1)}),$.each(t.mapper.collections,function(e,t){$.each(t.items,function(e,t){$.each(t.data("collection").childElements,function(e,t){t.validate(n)||(i=!1)})})}),r.setValid.call(this,i),e.debug("Validation",i?"success":"error"),i},isValid:function(){return n},updateConstraint:function(e,t,n){var r=$(e);if(!r.data("element"))throw"No validation element";$(e).data("element").updateConstraint(t,n)},deleteConstraint:function(e,t){var n=$(e);if(!n.data("element"))throw"No validation element";n.data("element").deleteConstraint(t)},addConstraint:function(e,n,r){var i=$(e),s;i.data("element")?i.data("element").addConstraint(n,r):(s=t.addField(e),s.addConstraint(n,r),t.elements.push(s))}};return r.initialize.call(i),i}}),define("form/mapper",["form/util"],function(e){"use strict";return function(t){var n={},r={initialize:function(){e.debug("INIT Mapper"),this.collections=[],this.collectionsSet={},this.emptyTemplates={},this.templates={},t.initialized.then(function(){var e='*[data-type="collection"]',n=t.$el.find(e);n.each(r.initCollection.bind(this))}.bind(this))},initCollection:function(n,i){var s=$(i),o=s.data("element"),u=s.data("mapper-property"),a,f,l,c=$.Deferred(),h=0,p=function(){h--,h===0&&c.resolve()};if(!$.isArray(u)){if(typeof u!="object")throw"no valid mapper-property value";u=[u],s.data("mapper-property",u)}return o.$children=s.children().clone(!0),s.html(""),f={id:_.uniqueId("collection_"),property:u,$element:s,element:o,items:[]},this.collections.push(f),h+=o.$children.length,o.$children.each(function(e,t){var n=$(t),i,s,c,h=0,d=function(){h--,h===0&&p()};if(!n.is("script"))throw"template has to be defined as <script>";a={tpl:n.html(),id:n.attr("id"),collection:f},o.$children[e]=a;for(s=-1,c=u.length;++s<c;)u[s].tpl===a.id&&(i=u[s].data,l=u[s]["empty-tpl"]),u[s]["empty-tpl"]&&u[s]["empty-tpl"]===a.id&&(this.emptyTemplates[u[s].data]={id:u[s]["empty-tpl"],tpl:n.html()});if(!i)d();else{a.propertyName=i,h=f.element.getType().getMinOccurs(),this.templates[i]={tpl:a,collection:f,emptyTemplate:l};for(s=f.element.getType().getMinOccurs()+1;--s>0;)r.appendChildren.call(this,f,a).then(function(){$("#current-counter-"+i).text(f.element.getType().getChildren(a.id).length),d()}.bind(this))}}.bind(this)),$.each(u,function(e,n){t.$el.on("click",'*[data-mapper-add="'+n.data+'"]',r.addClick.bind(this)),t.$el.on("click",'*[data-mapper-remove="'+n.data+'"]',r.removeClick.bind(this)),c.then(function(){r.emitInitCollectionEvent(n.data)})}.bind(this)),r.checkFullAndEmpty.call(this,u[0].data),c.then(function(){e.debug("collection resolved")}),c.promise()},addClick:function(e){var t=$(e.currentTarget),n=t.data("mapper-add"),i=this.templates[n].tpl,s=this.templates[n].collection;s.element.getType().canAdd(i.id)&&r.appendChildren.call(this,s,i).then(function(){$("#current-counter-"+n).text(s.element.getType().getChildren(i.id).length),r.emitAddEvent(n,null)}.bind(this)),r.checkFullAndEmpty.call(this,n)},addEmptyTemplate:function(e,t){if(this.emptyTemplates.hasOwnProperty(t)){var n=$(this.emptyTemplates[t].tpl);n.attr("id",this.emptyTemplates[t].id),e.append(n)}},removeClick:function(e){var t=$(e.currentTarget),n=t.data("mapper-remove"),i=this.templates[n].tpl,s=this.templates[n].collection,o=t.closest("."+n+"-element");s.element.getType().canRemove(i.id)&&(r.remove.call(this,o),$("#current-counter-"+n).text(s.element.getType().getChildren(i.id).length),r.emitRemoveEvent(n,null)),r.checkFullAndEmpty.call(this,n)},checkFullAndEmpty:function(e){var t=$("[data-mapper-add='"+e+"']"),n=$("[data-mapper-remove='"+e+"']"),r=this.templates[e].tpl,i=this.templates[e].collection,s=i.element.$el.data("mapper-full-class")||"full",o=i.element.$el.data("mapper-empty-class")||"empty";t.removeClass(s),t.removeClass(o),$(i.element.$el).removeClass(s),$(i.element.$el).removeClass(o);if(!!t.length||!!n.length)i.element.getType().canAdd(r.id)?i.element.getType().canRemove(r.id)||(t.addClass(o),$(i.element.$el).addClass(o)):(t.addClass(s),$(i.element.$el).addClass(s))},emitInitCollectionEvent:function(e){$(t.$el).trigger("form-collection-init",[e])},emitAddEvent:function(e,n){$(t.$el).trigger("form-add",[e,n])},emitRemoveEvent:function(e,n){$(t.$el).trigger("form-remove",[e,n])},processData:function(e,t,i){var s=$(e),o=s.data("type"),u=s.data("mapper-property"),a=s.data("element"),f,l;return t&&!!n[t.data]?l=n[t.data]:!n[u]||(l=n[u]),o!=="collection"?a?a.getValue():null:(f=[],$.each(s.children(),function(e,n){if(!t||t.tpl===n.dataset.mapperPropertyTpl){var s=$(n).data("collection").childElements,o=$(n).data("collection").childElementGroups,u={};s.forEach(function(e){r.addDataFromElement.call(this,e,u,i)});for(e in o)o.hasOwnProperty(e)&&(u[e]=o[e].getValue());!i||(u.mapperId=n.dataset.mapperId);var a=Object.keys(u);a.length===1?u[a[0]]!==""&&f.push(u[a[0]]):(!l||l(u))&&f.push(u)}}.bind(this)),f)},setCollectionData:function(e,t){var n=t.$element,i=this.templates[t.key].tpl,s=e.length,o=$.Deferred(),u=function(){s--,s===0&&o.resolve()},a,f;if(s===0)r.addEmptyTemplate.call(this,n,i.propertyName),o.resolve();else{if(e.length<t.element.getType().getMinOccurs())for(a=t.element.getType().getMinOccurs()+1,f=e.length;--a>f;)e.push({});t.items=[],$.each(e,function(e,n){r.appendChildren.call(this,t,i,n).then(function(e){r.setData.call(this,n,e).then(function(){u()}.bind(this))}.bind(this))}.bind(this))}return $("#current-counter-"+n.attr("id")).text(e.length),r.checkFullAndEmpty.call(this,t.property[0].data),o.promise()},appendChildren:function(n,i,s,o,u){var a=$.extend(!0,{},i),f=a.collection.element.getType().getChildren(a.id).length,l=$.extend({},{index:f},s||{}),c=_.template(a.tpl,l,t.options.delimiter),h=$(c),p=e.getFields(h),d=e.getRadios(h),v=e.getCheckboxes(h),m=$.Deferred(),g=p.length,y=n.$element,b,w;return h.attr("data-mapper-property-tpl",a.id),h.attr("data-mapper-id",_.uniqueId()),u&&(b=y.find('*[data-mapper-property-tpl="'+a.id+'"]').last()).length>0?b.after(h):y.append(h),a.collection.childElements=[],a.collection.childElementGroups={},p.length>0?p.each(function(e,n){w=t.createField($(n)),a.collection.childElements.push(w),w.initialized.then(function(){g--,g===0&&m.resolve(h)})}.bind(this)):m.resolve(h),_.size(d)>0&&$.each(d,function(e,n){a.collection.childElementGroups[e]=t.createFieldGroup(n,!0)}),_.size(v)>0&&$.each(v,function(e,n){a.collection.childElementGroups[e]=t.createFieldGroup(n,!1)}),h.data("collection",a.collection),!o||m.then(function(){r.setData.call(this,o,p)}.bind(this)),n.items.push(h),m.promise()},getElementByMapperId:function(e){for(var t=-1,n=this.collections.length;++t<n;)for(var r=-1,i=this.collections[t].items.length;++r<i;)if(this.collections[t].items[r].data("mapper-id")===e)return this.collections[t].items[r];return null},deleteElementByMapperId:function(e){var t;return $.each(this.collections,function(n,r){$.each(r.items,function(n,i){return i.data("mapper-id").toString()!==e.toString()?!0:(t=i.attr("data-mapper-property-tpl"),i.remove(),r.items.splice(n,1),!1)})}.bind(this)),t},remove:function(n){$.each(e.getFields(n),function(e,n){t.removeField(n)}.bind(this)),n.remove()},setData:function(e,n){n||(n=t.$el);var i=$.Deferred(),s,o,u,a=1,f=function(){a--,a===0&&i.resolve()};return typeof e!="object"?(s="*[data-mapper-property]",o=n.find(s),u=o.data("element"),u?u.setValue(e).then(function(){f()}):(u=t.addField(o),u.initialized.then(function(){u.setValue(e).then(function(){f()})}.bind(this)))):e!==null&&!$.isEmptyObject(e)?(a=Object.keys(e).length,$.each(e,function(e,i){var o,u,a;$.isArray(i)&&this.templates.hasOwnProperty(e)?(a=this.templates[e].collection,a.key=e,this.collectionsSet.hasOwnProperty(a.id)||a.$element.children().each(function(e,t){$(t).remove()}.bind(this)),this.collectionsSet[a.id]=!0,r.setCollectionData.call(this,i,a).then(function(){f()})):t.elementGroups.hasOwnProperty(e)?(t.elementGroups[e].setValue(i),f()):(s='*[data-mapper-property="'+e+'"]',o=n.andSelf().find(s),u=o.data("element"),o.length>0?u?u.setValue(i).then(function(){f()}):(u=t.addField(o),u.initialized.then(function(){u.setValue(i).then(function(){f()})}.bind(this))):f())}.bind(this))):i.resolve(),i.promise()},addDataFromElement:function(e,t,n){var i=e.$el,s=i.data("mapper-property"),o;if(!s)return;$.isArray(s)?$.each(s,function(e,s){t[s.data]=r.processData.call(this,i,s,n)}.bind(this)):s.match(/.*\..*/)?(o=s.split("."),t[o[0]]={},t[o[0]][o[1]]=r.processData.call(this,i)):t[s]=r.processData.call(this,i)},getDataFromElements:function(e,t,n){var i={};e.forEach(function(e){r.addDataFromElement.call(this,e,i,n)}.bind(this));for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s].getValue());return i}},i={setData:function(e,t){return this.collectionsSet={},r.setData.call(this,e,t)},getData:function(e,n){if(!e||!e.data("mapper-id"))return r.getDataFromElements(t.elements,t.elementGroups,n);var i=r.getElementByMapperId.call(this,e.data("mapper-id")).data("collection");return r.getDataFromElements(i.childElements,i.childElementGroups,n)},addCollectionFilter:function(e,t){n[e]=t},removeCollectionFilter:function(e){delete n[e]},addToCollection:function(e,t,n){var i=this.templates[e],s=i.collection.$element,o=!1,u,a,f=$.Deferred();return n||(o=!0),i.emptyTemplate&&(a=$(s).find("#"+i.emptyTemplate),a&&a.remove()),r.appendChildren.call(this,i.collection,i.tpl,t,t,o).then(function(e){f.resolve(e)}.bind(this)),f},editInCollection:function(e,t){var n=r.getElementByMapperId.call(this,e);r.setData.call(this,t,n)},removeFromCollection:function(e){var n,i=r.deleteElementByMapperId.call(this,e);if(t.$el.find("*[data-mapper-property-tpl="+i+"]").length<1)for(n in this.templates)if(this.templates[n].tpl.id===i){r.addEmptyTemplate.call(this,this.templates[n].collection.$element,n);return}}};return r.initialize.call(i),i}}),require.config({paths:{form:"js/form","form/mapper":"js/mapper","form/validation":"js/validation","form/element":"js/element","form/elementGroup":"js/elementGroup","form/util":"js/util","type/default":"js/types/default","type/readonly-select":"js/types/readonlySelect","type/string":"js/types/string","type/date":"js/types/date","type/decimal":"js/types/decimal","type/hiddenData":"js/types/hiddenData","type/mappingData":"js/types/mappingData","type/email":"js/types/email","type/url":"js/types/url","type/label":"js/types/label","type/select":"js/types/select","type/collection":"js/types/collection","type/attributes":"js/types/attributes","validator/default":"js/validators/default","validator/min":"js/validators/min","validator/max":"js/validators/max","validator/minLength":"js/validators/min-length","validator/maxLength":"js/validators/max-length","validator/required":"js/validators/required","validator/unique":"js/validators/unique","validator/equal":"js/validators/equal","validator/regex":"js/validators/regex"}}),define("form",["form/element","form/elementGroup","form/validation","form/mapper","form/util"],function(e,t,n,r,i){"use strict";return function(s,o){var u={debug:!1,delimiter:{interpolate:/<~=(.+?)~>/g,escape:/<~-(.+?)~>/g,evaluate:/<~(.+?)~>/g},validation:!0,validationTrigger:"focusout",validationAddClassesParent:!0,validationAddClasses:!0,validationSubmitEvent:!0,mapper:!0},a={initialize:function(){this.$el=$(s),this.options=$.extend(u,this.$el.data(),o),i.debugEnabled=this.options.debug,this.initialized=a.initFields.call(this),!this.options.validation||(this.validation=new n(this)),!this.options.mapper||(this.mapper=new r(this)),this.$el.data("form-object",this)},initFields:function(e){var t=$.Deferred(),n=0,r=function(){n--,n===0&&t.resolve()};return $.each(i.getFields(e||this.$el),function(e,t){n++,a.addField.call(this,t).initialized.then(r.bind(this))}.bind(this)),a.addGroupedFields.call(this,e),t.promise()},bindValidationDomEvents:function(){!this.options.validationSubmitEvent||this.$el.on("submit",function(){return this.validation.validate()}.bind(this))},createField:function(t){var n=$(t),r=i.parseData(n,"",this.options);return new e(n,f,r)},createFieldGroup:function(n,r){return new t(n.map(function(t){var n=$(t),r=i.parseData(n,"",this.options);return new e(n,f,r)}.bind(this)),r)},addField:function(e){var t=this.createField(e);return this.elements.push(t),i.debug("Element created",o),t},addSingleGroupedField:function(e,t,n){this.elementGroups[e]=this.createFieldGroup(t,n)},addGroupedFields:function(e){$.each(i.getCheckboxes(e||this.$el),function(e,t){t.length>1?a.addSingleGroupedField.call(this,e,t,!1):a.addField.call(this,t)}.bind(this)),$.each(i.getRadios(e||this.$el),function(e,t){a.addSingleGroupedField.call(this,e,t,!0)}.bind(this))}},f={elements:[],elementGroups:{},options:{},validation:!1,mapper:!1,createField:function(e){var t=a.createField(e);return t.initialized.then(function(){t.fieldAdded(t)}.bind(this)),t},createFieldGroup:function(e,t){return a.createFieldGroup(e,t)},addField:function(e){var t=a.addField.call(this,e);return t.initialized.then(function(){$.each(this.elements,function(e,t){t.fieldAdded(t)})}.bind(this)),t},addGroupedFields:function(e){return a.addGroupedFields.call(this,e)},initFields:function(e){return a.initFields.call(this,e)},removeFields:function(e){i.getFields(e).each(function(e,t){this.removeField(t)}.bind(this))},removeField:function(e){var t=$(e),n=t.data("element");$.each(this.elements,function(e,t){t.fieldRemoved(n)}),this.elements.splice(this.elements.indexOf(n),1)}};return a.initialize.call(f),f}}),define("type/default",["form/util"],function(e){"use strict";return function(t,n,r,i,s,o){var u={initialize:function(){this.$el=t,this.options=$.extend({},n,r);var e=$.Deferred();this.requireCounter=0,this.initialized=e.promise(),!this.initializeSub||this.initializeSub(),e.resolve()}},a={name:i,form:o,needsValidation:function(){return!0},updateConstraint:function(e){$.extend(this.options,e)},setValue:function(t){e.setValue(this.$el,this.getViewData.call(this,t))},getValue:function(){return this.getModelData.call(this,e.getValue(this.$el))},getViewData:function(e){return e},getModelData:function(e){return e}},f=$.extend({},a,s);return u.initialize.call(f),f}}),define("type/string",["type/default"],function(e){"use strict";return function(t,n){var r={},i={needsValidation:function(){return!1},validate:function(){return!0}};return new e(t,r,n,"string",i)}}),define("type/date",["type/default","form/util"],function(e,t){"use strict";return function(n,r){var i={format:"d"},s=function(e){return t.debug(e,new Date(e)),new Date(e)},o={validate:function(){var e=t.getValue(this.$el),n;return e===""?!0:(n=Globalize.parseDate(e,this.options.format),n!==null)},needsValidation:function(){var e=t.getValue(this.$el);return e!==""},getViewData:function(e){return Globalize.format(s(e),this.options.format)},getModelData:function(e){if(e!==""){var t=Globalize.parseDate(e,this.options.format);return t.toISOString()}return e}};return new e(n,i,r,"date",o)}}),define("type/decimal",["type/default"],function(e){"use strict";return function(t,n){var r={format:"n",regExp:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/,nullable:!1},i={initializeSub:function(){},validate:function(){var e=this.getValue();return e===""||this.options.nullable===!0&&e===null?!0:this.options.regExp.test(e)},getModelData:function(e){return e===""?this.options.nullable===!0?null:"":Globalize.parseFloat(e)},getViewData:function(e){if(typeof e=="string"){if(e==="")return"";e=parseFloat(e)}return Globalize.format(e,this.options.format)}};return new e(t,r,n,"decimal",i)}}),define("type/hiddenData",["type/default"],function(e){"use strict";return function(t,n){var r={id:"id",defaultValue:null},i={hiddenData:null,setValue:function(e){this.hiddenData=e,!!e&&typeof e=="object"&&!!e[this.options.id]&&this.$el.data("id",e[this.options.id])},getValue:function(){return this.hiddenData!==null?this.hiddenData:this.options.defaultValue},needsValidation:function(){return!1},validate:function(){return!0}};return new e(t,r,n,"hiddenData",i)}}),define("type/mappingData",["type/default"],function(e){"use strict";return function(t,n){var r={defaultValue:null,mapping:null,searchProperty:"id",showProperty:"name"},i={setValue:function(e){e!==null&&typeof e!="object"&&(this.$el.data("value",e),this.$el.text(this.getMappingValue(e)||this.options.defaultValue))},getValue:function(){var e=this.$el.data("value");return e!==null?e:this.options.defaultValue},needsValidation:function(){return!1},validate:function(){return!0},getMappingValue:function(e){var t,n=this.options.mapping;if(!!n)for(t in this.options.mapping)if(!!n.hasOwnProperty(t)&&n[t].hasOwnProperty(this.options.searchProperty)&&n[t].hasOwnProperty(this.options.showProperty)&&String(n[t][this.options.searchProperty])===String(e))return n[t][this.options.showProperty]}};return new e(t,r,n,"hiddenData",i)}}),define("type/email",["type/default","form/util"],function(e,t){"use strict";return function(t,n){var r={regExp:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))){2,6}$/i},i={validate:function(){var e=this.getValue();return e===""?!0:this.options.regExp.test(e)},needsValidation:function(){var e=this.getValue();return e!==""}};return new e(t,r,n,"email",i)}}),define("type/url",["type/default","form/util"],function(e,t){"use strict";return function(t,n){var r={regExp:/^(https?|s?ftp|git):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},i={validate:function(){var e=this.getValue();return e===""?!0:(this.options["url-strict"]!=="true"&&(e=(new RegExp("(https?|s?ftp|git)","i")).test(e)?e:"http://"+e),this.options.regExp.test(e))},needsValidation:function(){var e=this.getValue();return e!==""}};return new e(t,r,n,"email",i)}}),define("type/label",["type/default"],function(e){"use strict";return function(t,n){var r={id:"id",label:"name",translate:!0},i={setValue:function(e){if(!!e[this.options.label]){var t=e[this.options.label],n=e[this.options.label];!this.options.translate||(n=Globalize.localize(t,Globalize.culture().name),n===undefined&&(n=t)),this.$el.text(n)}!e[this.options.id]||this.$el.data(this.options.id,e[this.options.id])},getValue:function(){var e={};return e[this.options.id]=this.$el.data(this.options.id),e[this.options.label]=this.$el.text(),e},needsValidation:function(){return!1},validate:function(){return!0}};return new e(t,r,n,"label",i)}}),define("type/select",["type/default","form/util"],function(e,t){"use strict";return function(n,r){var i={id:"id",label:"name",type:"object"},s={setValue:function(e){typeof e=="object"?this.$el.val(e[this.options.id]):(this.$el.find("option[id="+e+"]").attr("selected","selected"),this.options.type="string")},getValue:function(){if(this.options.type==="object"){var e={};return e[this.options.id]=t.getValue(this.$el),e[this.options.label]=this.$el.find("option:selected").text(),e}return this.$el.children(":selected").attr("id")},needsValidation:function(){return!1},validate:function(){return!0}};return new e(n,i,r,"select",s)}}),define("type/readonly-select",["type/default"],function(e){"use strict";return function(t,n){var r={id:null,data:[],idProperty:"id",outputProperty:"name"},i={setValue:function(e){var t=this.options.data,n=this.options.idProperty,r,i;if(typeof e=="object"){if(!e.hasOwnProperty(n))throw"value has no property named "+n;e=e[n]}else if(e===null)return;this.$el.data("id",e);if(t.length>0)for(r=-1,i=t.length;++r<i;)if(t[r].hasOwnProperty(n)&&t[r][n].toString()===e.toString()){this.$el.html(t[r][this.options.outputProperty]);break}},getValue:function(){var e=this.$el.data("id"),t,n;for(t=-1,n=this.options.data.length;++t<n;)if(this.options.data[t][this.options.idProperty].toString()===e.toString())return this.options.data[t];return null},needsValidation:function(){return!1},validate:function(){return!0}};return new e(t,r,n,"readonly-select",i)}}),define("type/collection",["type/default"],function(e){"use strict";return function(t,n){var r={min:0,max:null},i={validate:function(){return!0},needsValidation:function(){return!1},getChildren:function(e){return this.$el.find('*[data-mapper-property-tpl="'+e+'"]')},getMinOccurs:function(){return this.options.min},getMaxOccurs:function(){return this.options.max},canAdd:function(e){var t=this.getChildren(e).length;return this.getMaxOccurs()===null||t<this.getMaxOccurs()},canRemove:function(e){var t=this.getChildren(e).length;return t>this.getMinOccurs()}};return new e(t,r,n,"collection",i)}}),define("type/attributes",["type/default"],function(e){"use strict";return function(t,n){var r={},i={setValue:function(e){this.$el.data("attributes",e)},getValue:function(){return this.$el.data("attributes")},needsValidation:function(){return!1},validate:function(){return!0}};return new e(t,r,n,"attributes",i)}}),define("validator/default",[],function(){"use strict";return function(e,t,n,r,i){return{name:i,initialize:function(){this.$el=e,this.data=$.extend(n,this.$el.data(),r),this.updateData(),!this.initializeSub||this.initializeSub()},validate:function(){},update:function(){return this.validate()},updateConstraint:function(e){$.extend(this.data,e),this.updateData()},updateData:function(){$.each(this.data,function(e,t){this.$el.data(e,t)}.bind(this))},fieldRemoved:function(){},fieldAdded:function(){}}}}),define("validator/min",["validator/default"],function(e){"use strict";return function(t,n,r,i){var s={min:0},o=$.extend(new e(t,n,s,i,"min"),{validate:function(){var e=this.data.element.getValue();return Number(e)>=this.data.min}});return o.initialize(),o}}),define("validator/max",["validator/default"],function(e){"use strict";return function(t,n,r,i){var s={max:999},o=$.extend(new e(t,n,s,i,"max"),{validate:function(){var e=this.data.element.getValue();return Number(e)<=this.data.max}});return o.initialize(),o}}),define("validator/minLength",["validator/default"],function(e){"use strict";return function(t,n,r,i){var s={minLength:0},o=$.extend(new e(t,n,s,i,"min-length"),{validate:function(){var e=this.data.element.getValue();return e.length>=this.data.minLength}});return o.initialize(),o}}),define("validator/maxLength",["validator/default"],function(e){"use strict";return function(t,n,r,i){var s={maxLength:999},o=$.extend(new e(t,n,s,i,"max-length"),{validate:function(){var e=this.data.element.getValue();return e.length<=this.data.maxLength}});return o.initialize(),o}}),define("validator/required",["validator/default"],function(e){"use strict";return function(t,n,r,i){var s={},o=$.extend(new e(t,n,s,i,"required"),{validate:function(){if(!this.data.required)return!0;var e=this.data.element.getValue();return typeof e=="number"?!0:(!_.isString(e)||(e=e.trim()),e?_.size(e)>0:!1)}});return o.initialize(),o}}),define("validator/unique",["validator/default","form/util"],function(e,t){"use strict";return function(n,r,i,s){var o={validationUnique:null},u=[],a=function(e,t){return u.indexOf(e)&&!!e.options.validationUnique&&e.options.validationUnique===t},f=function(e){var t=!0;return $.each(u,function(n,r){return l(e,r)?!0:(t=!1,!1)}),t},l=function(e,t){return e!==t.getValue()},c=function(){$.each(u,function(e,t){t.update()})},h=$.extend({},new e(n,r,o,s,"unique"),{initializeSub:function(){i.initialized.then(function(){$.each(r.elements,function(e,t){this.fieldAdded(t)}.bind(this))}.bind(this))},validate:function(){var e=this.data.element.getValue(),t;if(!this.data.unique)throw"No option group set";return t=f(e),c(),t},update:function(){var e=this.data.element.getValue(),t;if(!this.data.unique)throw"No option group set";return t=f(e),t},fieldAdded:function(e){e.$el!==this.$el&&a(e,this.data.unique)&&(t.debug("field added",this.$el),u.push(e))},fieldRemoved:function(e){t.debug("field removed",this.$el),u=u.splice(u.indexOf(e),1)}});return h.initialize(),h}}),define("validator/equal",["validator/default"],function(e){"use strict";return function(t,n,r,i){var s={equal:null},o=[],u=function(e,t){return o.indexOf(e)&&!!e.options.validationEqual&&e.options.validationEqual===t},a=function(e){var t=!0;return $.each(o,function(n,r){return f(e,r)?!0:(t=!1,!1)}),t},f=function(e,t){return e===t.getValue()},l=function(){$.each(o,function(e,t){t.update()})},c=$.extend(new e(t,n,s,i,"equal"),{initializeSub:function(){r.initialized.then(function(){$.each(n.elements,function(e,t){this.fieldAdded(t)}.bind(this))}.bind(this))},validate:function(){var e=this.$el.val(),t;if(!this.data.equal)throw"No option group set";return t=a(e),l(),t},update:function(){var e=this.data.element.getValue(),t;if(!this.data.equal)throw"No option group set";return t=a(e),t},fieldAdded:function(e){e.$el!==this.$el&&u(e,this.data.equal)&&o.push(e)},fieldRemoved:function(e){o=o.splice(o.indexOf(e),1)}});return c.initialize(),c}}),define("validator/regex",["validator/default"],function(e){"use strict";return function(t,n,r,i){var s={regex:/\w*/},o=$.extend(new e(t,n,s,i,"regex"),{validate:function(){var e=this.data.regex,t=new RegExp(e),n=this.data.element.getValue();return n===""?!0:t.test(n)}});return o.initialize(),o}});