function typeOf(a){var b=typeof a;return"object"===b&&(a?a instanceof Array&&(b="array"):b="null"),b}var libFuncName=null;if("undefined"==typeof jQuery&&"undefined"==typeof Zepto&&"function"==typeof $)libFuncName=$;else if("function"==typeof jQuery)libFuncName=jQuery;else{if("function"!=typeof Zepto)throw new TypeError;libFuncName=Zepto}!function(a,b){"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;++c)c in this&&a.call(b,this[c],c,this)}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var c=Array.prototype.slice.call(arguments,1),d=this,e=function(){},f=function(){return d.apply(this instanceof e?this:a||b,c.concat(Array.prototype.slice.call(arguments)))};return e.prototype=this.prototype,f.prototype=new e,f});var c={version:"0.1.0",Ui:{},Util:{},$:function(){return"undefined"!=typeof Zepto?Zepto:jQuery}()};c.DEBUG=!1;var d=/\s+/;c.Events={on:function(a,b,c){var e,f,g;if(!b)return this;for(a=a.split(d),e=this._callbacks||(this._callbacks={});f=a.shift();)g=e[f]||(e[f]=[]),g.push(b,c);return this},off:function(a,b,c){var e,f,g,h;if(!(f=this._callbacks))return this;if(!(a||b||c))return delete this._callbacks,this;for(a=a?a.split(d):_.keys(f);e=a.shift();)if((g=f[e])&&(b||c))for(h=g.length-2;h>=0;h-=2)b&&g[h]!==b||c&&g[h+1]!==c||g.splice(h,2);else delete f[e];return this},trigger:function(a){var b,c,e,f,g,h,i,j;if(!(c=this._callbacks))return this;for(j=[],a=a.split(d),f=1,g=arguments.length;g>f;f++)j[f-1]=arguments[f];for(;b=a.shift();){if((i=c.all)&&(i=i.slice()),(e=c[b])&&(e=e.slice()),e)for(f=0,g=e.length;g>f;f+=2)e[f].apply(e[f+1]||this,j);if(i)for(h=[b].concat(j),f=0,g=i.length;g>f;f+=2)i[f].apply(i[f+1]||this,h)}return this}},c.Collection={byId:{},objs:[],add:function(a){this.byId[a.id]=a,this.objs.push(a)},get:function(a){return this.byId[a.id||a]}},c.Model={get:function(a){return this[a]},set:function(a,b){return!!b&&(this[a]=b),this}},b.Husky=c}(libFuncName,this,this.document),function(a,b,c,d){"use strict";var e="Husky.Ui.DataGrid";Husky.Ui.DataGrid=function(b,c){this.name=e,Husky.DEBUG&&console.log(this.name,"create instance"),this.options=c,this.configs={},this.$originalElement=a(b),this.$element=a('<div class="husky-data-grid"/>'),a(b).append(this.$element),this.allItemIds=[],this.selectedItemIds=[],this.data=null,this.options.pagination=this.options.pagination!==d?!!this.options.pagination:!!this.options.url,this.options.url?this.load({url:this.options.url}):this.options.data.items&&(this.data=this.options.data,Husky.DEBUG&&console.log(this.data,"this.data set"),this.setConfigs(),this.prepare().appendPagination().render(),Husky.DEBUG&&console.log("data.items found"))},a.extend(Husky.Ui.DataGrid.prototype,Husky.Events,{vent:function(){return a.extend({},Husky.Events)}(),getUrl:function(a){var b="?";-1!=a.url.indexOf("?")&&(b="&");var c=a.url+b+"pageSize="+this.options.paginationOptions.pageSize;return a.page>1&&(c+="&page="+a.page),c},load:function(a){Husky.DEBUG&&console.log(this.name,"load"),Husky.Util.ajax({url:this.getUrl(a),data:a.data,success:function(b){Husky.DEBUG&&console.log(this.name,"load","success"),this.data=b,this.setConfigs(),this.prepare().appendPagination().render(),"function"==typeof a.success&&a.success(b)}.bind(this)})},setConfigs:function(){this.configs={},this.configs.total=this.data.total,this.configs.pageSize=this.data.pageSize,this.configs.page=this.data.page},prepare:function(){return this.$element.empty(),"list"===this.options.elementType||this.$element.append(this.prepareTable()),this},prepareTable:function(){var b,c,d,e;return b=a("<table/>"),(this.data.head||this.options.tableHead)&&(c=a("<thead/>"),c.append(this.prepareTableHead()),b.append(c)),this.data.items&&(d=a("<tbody/>"),d.append(this.prepareTableRows()),b.append(d)),e=[],e.push(this.options.className&&"table"!==this.options.className?"table "+this.options.className:"table"),e.push(this.options.selectItemType&&"checkbox"===this.options.selectItemType?"is-selectable":""),b.addClass(e.join(" ")),b},prepareTableHead:function(){var a,b,c,d;return a=[],d=this.options.tableHead||this.data.head,this.options.selectItemType&&"checkbox"===this.options.selectItemType&&a.push('<th class="select-all">',this.templates.checkbox({id:"select-all"}),"</th>"),d.forEach(function(d){b=d.class?' class="'+d.class+'"':"",c=d.width?' width="'+d.width+'px"':"",a.push("<th"+b+c+">"+d.content+"</th>")}),"<tr>"+a.join("")+"</tr>"},prepareTableRows:function(){var a;return a=[],this.allItemIds=[],this.data.items.forEach(function(b){a.push(this.prepareTableRow(b))}.bind(this)),a.join("")},prepareTableRow:function(a){if(this.options.template&&this.options.template.row)return _.template(this.options.template.row,a);var b,c,d,e,f;e=[],b=a.id?' data-id="'+a.id+'"':"",!!a.id&&this.allItemIds.push(~~a.id),this.options.selectItemType&&"checkbox"===this.options.selectItemType?e.push("<td>",this.templates.checkbox(),"</td>"):this.options.selectItemType&&"radio"===this.options.selectItemType&&e.push("<td>",this.templates.radio({name:"husky-radio"}),"</td>");for(var g in a){var h=a[g];f=[],c=h.thumb?'<img alt="'+(h.alt||"")+'" src="'+h.thumb+'"/>':h,!!h.class&&f.push(h.class),!!h.thumb&&f.push("thumb"),d=f.length?'class="'+f.join(" ")+'"':"",e.push("<td "+d+" >"+c+"</td>")}return this.options.removeRow&&e.push('<td class="remove-row">',this.templates.removeRow(),"</td>"),"<tr"+b+">"+e.join("")+"</tr>"},resetItemSelection:function(){this.allItemIds=[],this.selectedItemIds=[]},selectItem:function(b){Husky.DEBUG&&console.log(this.name,"selectItem");var c,d;c=a(b.currentTarget),d=c.parents("tr").data("id"),this.selectedItemIds.indexOf(d)>-1?(c.removeClass("is-selected").find('td:first-child input[type="checkbox"]').prop("checked",!1),a("th.select-all").find('input[type="checkbox"]').prop("checked",!1),this.selectedItemIds.splice(this.selectedItemIds.indexOf(d),1),this.trigger("data-grid:item:deselect",d)):(c.addClass("is-selected").find('td:first-child input[type="checkbox"]').prop("checked",!0),this.selectedItemIds.push(d),this.trigger("data-grid:item:select",d))},selectAllItems:function(a){Husky.DEBUG&&console.log(this.name,"selectAllItems"),a.stopPropagation(),Husky.Util.compare(this.selectedItemIds,this.allItemIds)?(this.$element.find('input[type="checkbox"]').prop("checked",!1),this.selectedItemIds=[],this.trigger("data-grid:all:deselect",null)):(this.$element.find('input[type="checkbox"]').prop("checked",!0),this.selectedItemIds=this.allItemIds.slice(0),this.trigger("data-grid:all:select",this.selectedItemIds))},addRow:function(a){Husky.DEBUG&&console.log(this.name,"addRow");var b;b=this.$element.find("table"),b.append(this.prepareTableRow(a))},removeRow:function(b){Husky.DEBUG&&console.log(this.name,"removeRow");var c,d;c=a(b.currentTarget),d=c.parent().parent(),this.trigger("data-grid:row:removed",d.data("id")),d.remove()},appendPagination:function(){return this.options.pagination&&this.$element.append(this.preparePagination()),this},preparePagination:function(){var b;return this.configs.total&&~~this.configs.total>=1&&(b=a("<div/>"),b.addClass("pagination"),b.append(this.preparePaginationPrevNavigation()),b.append(this.preparePaginationPageNavigation()),b.append(this.preparePaginationNextNavigation())),b},preparePaginationPageNavigation:function(){return this.templates.paginationPageNavigation({pageSize:this.options.paginationOptions.pageSize,selectedPage:this.configs.page})},preparePaginationNextNavigation:function(){return this.templates.paginationNextNavigation({next:this.options.pagination.next,selectedPage:this.configs.page,pageSize:this.configs.total})},preparePaginationPrevNavigation:function(){return this.templates.paginationPrevNavigation({prev:this.options.pagination.prev,selectedPage:this.configs.page})},changePage:function(b){Husky.DEBUG&&console.log(this.name,"changePage");var c,d;c=a(b.currentTarget),d=c.data("page"),this.addLoader(),this.load({url:this.options.url,page:d,success:function(){this.removeLoader()}.bind(this)}),this.trigger("data-grid:page:change",null),this.vent.trigger("data-grid:update",null)},changePageSize:function(){},bindDOMEvents:function(){this.$element.off(),this.options.selectItemType&&"checkbox"===this.options.selectItemType?(this.$element.on("click",'tbody > tr input[type="checkbox"]',this.selectItem.bind(this)),this.$element.on("click","th.select-all",this.selectAllItems.bind(this))):this.options.selectItemType&&"radio"===this.options.selectItemType&&this.$element.on("click",'tbody > tr input[type="radio"]',this.selectItem.bind(this)),this.options.pagination&&this.$element.on("click",".pagination li.page",this.changePage.bind(this)),this.options.removeRow&&this.$element.on("click",".remove-row > span",this.removeRow.bind(this))},bindCustomEvents:function(){this.vent.off(),this.vent.on("data-grid:update",this.updateHandler.bind(this)),this.on("data-grid:row:add",this.addRow.bind(this)),this.on("data-grid:row:remove",this.removeRow.bind(this))},updateHandler:function(){this.resetItemSelection()},render:function(){this.$originalElement.html(this.$element),this.bindCustomEvents(),this.bindDOMEvents()},addLoader:function(){return this.$element.outerWidth(this.$element.outerWidth()).outerHeight(this.$element.outerHeight()).empty().addClass("is-loading")},removeLoader:function(){return this.$element.removeClass("is-loading")},templates:{removeRow:function(){return['<span class="icon-remove"></span>'].join("")},checkbox:function(a){var b,c;return a=a||{},b=a.id?' id="'+a.id+'"':"",c=a.name?' name="'+a.name+'"':"",["<input",b,c,' type="checkbox" class="custom-checkbox"/>','<span class="custom-checkbox-icon"></span>'].join("")},radio:function(a){var b,c;return a=a||{},b=a.id?' id="'+a.id+'"':"",c=a.name?' name="'+a.name+'"':"",["<input",b,c,' type="radio" class="custom-radio"/>','<span class="custom-radio-icon"></span>'].join("")},paginationPrevNavigation:function(a){var b;return a=a||{},b=~~a.selectedPage,["<ul>",'<li class="pagination-first page" data-page="1"></li>','<li class="pagination-prev page" data-page="',b-1,'">',"Previous","</li>","</ul>"].join("")},paginationNextNavigation:function(a){var b,c,d,e;return a=a||{},b=a.next||"Next",c=a.last||"Last",d=a.pageSize,e=~~a.selectedPage,["<ul>",'<li class="pagination-next page" data-page="',e+1,'">',b,"</li>",'<li class="pagination-last page" data-page="',d,'"></li>',"</ul>"].join("")},paginationPageNavigation:function(a){var b,c,d,e,f;for(a=a||{},b=~~a.pageSize,e=~~a.selectedPage,d=[],c=1;b>=c;c++)f=e===c?'class="page is-selected"':'class="page"',d.push("<li ",f,' data-page="',c,'">',c,"</li>");return d.push('<li class="is-disabled">...</li>'),"<ul>"+d.join("")+"</ul>"}}}),a.fn.huskyDataGrid=function(b){var c=a(this);return b=a.extend({},a.fn.huskyDataGrid.defaults,"object"==typeof b&&b),c.data(e)?this:(c.data(e,new Husky.Ui.DataGrid(this,b)),this)},a.fn.huskyDataGrid.defaults={elementType:"table",selectItemType:null,pagination:!1,paginationOptions:{pageSize:10,showPages:5}}}(Husky.$,this,this.document),function(a){"use strict";var b="Husky.Ui.Navigation";Husky.Ui.Navigation=function(c,d){this.name=b,Husky.DEBUG&&console.log(this.name,"create instance"),this.options=d,this.configs={},this.$element=a(c),this.$navigation=a("<div/>",{"class":"navigation"}),this.currentColumnIdx=0,this.lastColumnIdx=0,this.data=null,this.columnHeader=null,this.columnItems=null,this.options.url&&this.load({url:this.options.url,success:function(){this.prepareNavigation(),this.render()}.bind(this)})},a.extend(Husky.Ui.Navigation.prototype,Husky.Events,{vent:function(){return a.extend({},Husky.Events)}(),load:function(a){Husky.DEBUG&&console.log(this.name,"load"),Husky.Util.ajax({url:a.url,success:function(b){Husky.DEBUG&&console.log(this.name,"load","success",b),this.data=b,this.columnHeader=this.data.header||null,this.columnItems=this.data.sub.items||null,"function"==typeof a.success&&a.success(this.data)}.bind(this)})},prepareNavigation:function(){return this.$navigationColumns=a("<ul/>",{"class":"navigation-columns"}),this.$navigationColumns.append(this.prepareNavigationColumn()),this.$navigation.append(this.$navigationColumns),this},prepareNavigationColumn:function(){var b;return b=a("<li/>",{id:"column-"+this.currentColumnIdx,"data-column-id":this.currentColumnIdx,"class":"navigation-column"}),b.append(this.prepareColumnItems()),b},prepareColumnItems:function(){var b,c,d,e,f,g,h,i,j,k;return c=[],b=a("<ul/>",{"class":"navigation-items"}),this.columnItems&&(this.itemsCollection&&delete this.itemsCollection,this.itemsCollection=new this.collections.items,this.columnItems.forEach(function(a){j=this.models.item(a),this.itemsCollection.add(j),e=[],!!j.get("class")&&e.push(j.get("class")),e.push("navigation-column-item"),d=' class="'+e.join(" ")+'"',g=j.get("hasSub")?' data-has-sub="true"':"",i='title="'+j.get("title")+'"',h=j.get("icon")?'<span class="icon-'+j.get("icon")+'"></span>':"",k='id="'+j.get("id")+'"',c.push("<li ",k,i,d,f,g,">",h,j.get("title"),"</li>")}.bind(this)),b.append(c.join(""))),b},addColumn:function(){var a,b;if(this.currentColumnIdx++,this.currentColumnIdx<this.lastColumnIdx||this.currentColumnIdx===this.lastColumnIdx)for(b=this.currentColumnIdx;b<=this.lastColumnIdx;b++)a=this.$navigationColumns.find("#column-"+b),a.size()&&a.remove();this.$navigationColumns.append(this.prepareNavigationColumn())},selectItem:function(b){Husky.DEBUG&&console.log(this.name,"selectItem");var c,d,e,f,g;c=a(b.currentTarget),d=c.parent().parent(),e=a("#column-0"),f=c.attr("id"),g=this.itemsCollection.get(f),this.lastColumnIdx=this.currentColumnIdx,this.currentColumnIdx=d.data("column-id"),g&&(d.find(".selected").removeClass("selected"),c.addClass("selected"),this.trigger("navigation:item:selected",g),g.get("hasSub")?g.get("sub")?(this.columnItems=g.get("sub").items,this.addColumn()):(this.addLoader(c),this.load({url:g.get("action"),success:function(){this.addColumn(),this.hideLoader(c),this.currentColumnIdx>1?e.addClass("collapsed"):e.removeClass("collapsed"),this.trigger("navigation:item:sub:loaded",g)}.bind(this)})):"content"==g.get("type")&&this.trigger("navigation:item:content:show",g))},bindDOMEvents:function(){this.$element.off(),this.$element.on("click",".navigation-column-item:not(.selected)",this.selectItem.bind(this))},render:function(){this.$element.html(this.$navigation),this.bindDOMEvents()},addLoader:function(a){a.addClass("loading")},hideLoader:function(a){a.removeClass("loading")},collections:{items:function(){return a.extend({},Husky.Collection)}},models:{item:function(b){var c={title:"",hasSub:!1};return a.extend({},Husky.Model,c,b)}},template:{search:function(a){return a=a||{},a.action=a.action||"",a.icon=a.icon||"",['<input type="text" class="search" autofill="false" data-action="',a.action,'" placeholder="Search ..."/>'].join()}}}),a.fn.huskyNavigation=function(c){var d=a(this);return c=a.extend({},a.fn.huskyNavigation.defaults,"object"==typeof c&&c),d.data(b)?this:(d.data(b,new Husky.Ui.Navigation(this,c)),this)},a.fn.huskyNavigation.defaults={url:"",collapse:!1}}(Husky.$,this,this.document),function(a){"use strict";Husky.Util={ajax:function(b){return b=a.extend({type:"GET"},b),a.ajax(b)},compare:function(a,b){return"array"===typeOf(a)&&"array"===typeOf(b)?JSON.stringify(a)===JSON.stringify(b):void 0},template:function(){}}}(Husky.$,this,this.document);