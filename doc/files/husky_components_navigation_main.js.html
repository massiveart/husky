<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>husky_components/navigation/main.js - husky</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="husky"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AutoCompleteList.html">AutoCompleteList</a></li>
            
                <li><a href="../classes/CKEditor.html">CKEditor</a></li>
            
                <li><a href="../classes/ColumnNavigation.html">ColumnNavigation</a></li>
            
                <li><a href="../classes/DataGrid.html">DataGrid</a></li>
            
                <li><a href="../classes/EditToolbar.html">EditToolbar</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/PageFunctions.html">PageFunctions</a></li>
            
                <li><a href="../classes/Search.html">Search</a></li>
            
                <li><a href="../classes/Toolbar.html">Toolbar</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/husky_components_auto-complete-list.html">husky/components/auto-complete-list</a></li>
            
                <li><a href="../modules/husky_components_column-navigation.html">husky/components/column-navigation</a></li>
            
                <li><a href="../modules/husky_components_column-options.html">husky/components/column-options</a></li>
            
                <li><a href="../modules/husky_components_edit-toolbar.html">husky/components/edit-toolbar</a></li>
            
                <li><a href="../modules/husky_components_page-functions.html">husky/components/page-functions</a></li>
            
                <li><a href="../modules/husky_components_toolbar.html">husky/components/toolbar</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: husky_components/navigation/main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * This file is part of the Sulu CMS.
 *
 * (c) MASSIVE ART WebServices GmbH
 *
 * This source file is subject to the MIT license that is bundled
 * with this source code in the file LICENSE.
 *
 * Name: navigation
 *
 * Description:
 *  Navigation Element
 *  also loads search component
 *
 * Options:
 *  footerTemplate - html template to define the footer
 *
 * Provides Events:
 *  husky.navigation.footer.set - set template
 *
 * Triggers Events:
 *  husky.navigation.item.select - {item}
 *  husky.navigation.item.toggle - isExpanded, {item}
 *  husky.navigation.item.settings - {item}
 *
 */

// TODO: arrow keys
// TODO: action as link for ux -&gt; footer where it will link
// TODO: cogwheel at dashboard in the middle
// TODO: events as specified
// TODO: move functions into private space
// TODO: cleanup css-classes
// TODO: responsive collapsed navigation

define(function() {

    &#x27;use strict&#x27;;

    var templates = {
            /** component skeleton */
            skeleton: [
                &#x27;&lt;nav class=&quot;navigation&quot;&gt;&#x27;,
                &#x27;   &lt;div class=&quot;navigation-content&quot;&gt;&#x27;,
                &#x27;       &lt;header class=&quot;navigation-header&quot;&gt;&#x27;,
                &#x27;           &lt;div class=&quot;navigation-header-image&quot;&gt;&#x27;,
                &#x27;               &lt;% if (icon) { %&gt;&#x27;,
                &#x27;               &lt;img alt=&quot;#&quot; src=&quot;&lt;%= icon %&gt;&quot;/&gt;&#x27;,
                &#x27;               &lt;% } %&gt;&#x27;,
                &#x27;           &lt;/div&gt;&#x27;,
                &#x27;           &lt;div class=&quot;navigation-header-title&quot;&gt;&lt;% if (title) { %&gt; &lt;%= translate(title) %&gt;&lt;% } %&gt;&lt;/div&gt;&#x27;,
                &#x27;       &lt;/header&gt;&#x27;,
                &#x27;       &lt;div id=&quot;navigation-search&quot; class=&quot;navigation-search&quot;&gt;&lt;/div&gt;&#x27;,
                &#x27;       &lt;div id=&quot;navigation-item-container&quot; class=&quot;navigation-item-container&quot;&gt;&lt;/div&gt;&#x27;,
                &#x27;       &lt;footer&gt;&#x27;,
                &#x27;       &lt;/footer&gt;&#x27;,
                &#x27;   &lt;/div&gt;&#x27;,
                &#x27;&lt;/nav&gt;&#x27;].join(&#x27;&#x27;),
            /** main navigation items (with icons)*/
            mainItem: [
                &#x27;&lt;li class=&quot;js-navigation-items navigation-items&quot; id=&quot;&lt;%= item.id %&gt;&quot; data-id=&quot;&lt;%= item.id %&gt;&quot;&gt;&#x27;,
                &#x27;   &lt;div &lt;% if (item.items &amp;&amp; item.items.length &gt; 0) { %&gt; class=&quot;navigation-items-toggle&quot; &lt;% } %&gt; &gt;&#x27;,
                &#x27;       &lt;a class=&quot;&lt;% if (!!item.action) { %&gt;js-navigation-item &lt;% } %&gt;navigation-item&quot; href=&quot;#&quot;&gt;&#x27;,
                &#x27;           &lt;span class=&quot;&lt;%= icon %&gt; navigation-item-icon&quot;&gt;&lt;/span&gt;&#x27;,
                &#x27;           &lt;span class=&quot;navigation-item-title&quot;&gt;&lt;%= translate(item.title) %&gt;&lt;/span&gt;&#x27;,
                &#x27;       &lt;/a&gt;&#x27;,
                &#x27;       &lt;% if (item.hasSettings) { %&gt;&#x27;,
                &#x27;           &lt;a class=&quot;icon-cogwheel navigation-settings-icon js-navigation-settings&quot; id=&quot;&lt;%= item.id %&gt;&quot; href=&quot;#&quot;&gt;&lt;/a&gt;&#x27;,
                &#x27;       &lt;% } %&gt;&#x27;,
                &#x27;       &lt;% if (item.items &amp;&amp; item.items.length &gt; 0) { %&gt;&#x27;,
                &#x27;           &lt;a class=&quot;icon-chevron-right navigation-toggle-icon&quot; href=&quot;#&quot;&gt;&lt;/a&gt;&#x27;,
                &#x27;       &lt;% } %&gt;&#x27;,
                &#x27;   &lt;/div&gt;&#x27;,
                &#x27;&lt;/li&gt;&#x27;].join(&#x27;&#x27;),
            /** sub navigation items */
            subToggleItem: [
                &#x27;   &lt;li class=&quot;js-navigation-items navigation-subitems&quot; id=&quot;&lt;%= item.id %&gt;&quot; data-id=&quot;&lt;%= item.id %&gt;&quot;&gt;&#x27;,
                &#x27;       &lt;div class=&quot;navigation-subitems-toggle&quot;&gt;&#x27;,
                &#x27;           &lt;a class=&quot;&lt;% if (!!item.action) { %&gt;js-navigation-item &lt;% } %&gt; navigation-item&quot; href=&quot;#&quot;&gt;&lt;%= translate(item.title) %&gt;&lt;/a&gt;&#x27;,
                &#x27;           &lt;% if (item.hasSettings) { %&gt;&#x27;,
                &#x27;           &lt;a class=&quot;icon-cogwheel navigation-settings-icon js-navigation-settings&quot; href=&quot;#&quot;&gt;&lt;/a&gt;&#x27;,
                &#x27;           &lt;% } %&gt;&#x27;,
                &#x27;           &lt;a class=&quot;icon-chevron-right navigation-toggle-icon&quot; href=&quot;#&quot;&gt;&lt;/a&gt;&#x27;,
                &#x27;       &lt;/div&gt;&#x27;,
                &#x27;&lt;/li&gt;&#x27;].join(&#x27;&#x27;),
            /** siple sub item */
            subItem: [
                &#x27;&lt;li class=&quot;js-navigation-sub-item&quot; id=&quot;&lt;%= item.id %&gt;&quot; data-id=&quot;&lt;%= item.id %&gt;&quot;&gt;&#x27;,
                &#x27;   &lt;a href=&quot;#&quot;&gt;&lt;%= translate(item.title) %&gt;&lt;/a&gt;&#x27;,
                &#x27;&lt;/li&gt;&#x27;
            ].join(&#x27;&#x27;)
        },
        defaults = {
            footerTemplate: &#x27;&#x27;,
            labels: {
                hide: &#x27;navigation.hide&#x27;,
                show: &#x27;navigation.show&#x27;
            }
        };


    return {

        initialize: function() {

            this.sandbox.logger.log(&#x27;Initialized Navigation&#x27;);

            // merging options
            this.options = this.sandbox.util.extend(true, {}, defaults, this.options);

            // binding dom events
            this.bindDOMEvents();

            this.bindCustomEvents();

            // load Data
            if (!!this.options.url) {
                this.sandbox.util.load(this.options.url)
                    .then(this.render.bind(this))
                    .fail(function(data) {
                        this.sandbox.logger.log(&quot;data could not be loaded:&quot;, data);
                    }.bind(this));
            }
        },

        /**
         * renders the navigation
         * gets called after navigation data was loaded
         * @param data
         */
        render: function(data) {

            // data storage
            this.options.data = data;

            // array to save all navigation items
            this.items = [];

            // add container class to current div
            this.sandbox.dom.addClass(this.$el, &#x27;navigation-container&#x27;);

            // render skeleton
            this.sandbox.dom.html(this.$el, this.sandbox.template.parse(templates.skeleton, {
                title: this.options.data.title,
                icon: this.options.data.icon,
                translate: this.sandbox.translate
            }));

            // start search component
            this.sandbox.start([
                {
                    name: &#x27;search@husky&#x27;,
                    options: {
                        el: &#x27;#navigation-search&#x27;,
                        placeholderText: &#x27;public.search&#x27;
                    }
                }
            ]);

            // render navigation items
            this.renderNavigationItems(this.options.data);

            // render footer
            if (!!this.options.footerTemplate &amp;&amp; this.options.footerTemplate !== &#x27;&#x27;) {
                this.renderFooter(this.options.footerTemplate);
            }

            // preselect item based on url
            this.preselectItem();

            // emit initialized event
            this.sandbox.emit(&#x27;husky.navigation.initialized&#x27;);
        },

        /**
         *  renders main navigation elements
         */
        renderNavigationItems: function(data) {
            var $elem, $sectionDiv, $sectionList;
            // iterate through sections
            this.sandbox.util.foreach(data.items, function(section) {
                $sectionDiv = this.sandbox.dom.createElement(&#x27;&lt;div class=&quot;section&quot;&gt;&#x27;);
                $sectionList = this.sandbox.dom.createElement(&#x27;&lt;ul class=&quot;section-items&quot;&gt;&#x27;);
                this.sandbox.dom.append($sectionDiv, &#x27;&lt;div class=&quot;section-headline&quot;&gt;&lt;span class=&quot;section-headline-title&quot;&gt;&#x27; + this.sandbox.translate(section.title).toUpperCase() + &#x27;&lt;/span&gt;&lt;span class=&quot;section-toggle&quot;&gt;&lt;a href=&quot;#&quot;&gt;&#x27; + this.sandbox.translate(this.options.labels.hide) + &#x27;&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;&#x27;);

                // iterate through section items
                this.sandbox.util.foreach(section.items, function(item) {
                    // create item
                    $elem = this.sandbox.dom.createElement(this.sandbox.template.parse(templates.mainItem, {
                        item: item,
                        icon: item.icon ? &#x27;icon-&#x27; + item.icon : &#x27;&#x27;,
                        translate: this.sandbox.translate
                    }));
                    //render sub-items
                    if (item.items &amp;&amp; item.items.length &gt; 0) {
                        this.renderSubNavigationItems(item, $elem);
                    }
                    this.sandbox.dom.append($sectionList, $elem);
                    item.domObject = $elem;
                    this.items[item.id] = item;
                }.bind(this));

                this.sandbox.dom.append($sectionDiv, $sectionList);
                this.sandbox.dom.append(&#x27;#navigation-item-container&#x27;, $sectionDiv);

            }.bind(this));
        },

        /**
         * renders sub-navigation elements
         */
        renderSubNavigationItems: function(data, $parentList) {
            var elem,
                list = this.sandbox.dom.createElement(&#x27;&lt;ul style=&quot;display:none&quot; /&gt;&#x27;);

            this.sandbox.util.foreach(data.items, function(item) {
                this.items[item.id] = item;
                if (item.items &amp;&amp; item.items.length &gt; 0) {
                    elem = this.sandbox.dom.createElement(this.sandbox.template.parse(templates.subToggleItem, {item: item, translate: this.sandbox.translate}));
                    this.renderSubNavigationItems(item, this.sandbox.dom.find(&#x27;div&#x27;, elem));
                } else {
                    elem = this.sandbox.dom.createElement(this.sandbox.template.parse(templates.subItem, {item: item, translate: this.sandbox.translate}));
                }
                this.sandbox.dom.append(list, elem);
                item.domObject = elem;
            }.bind(this));

            this.sandbox.dom.append($parentList, list);
        },

        renderFooter: function(footerTemplate) {
            var $footer = this.sandbox.dom.find(&#x27;footer&#x27;, this.$el);
            this.sandbox.dom.html($footer, footerTemplate);
        },

        /**
         * Interaction
         */
        bindDOMEvents: function() {
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.toggleItems.bind(this), &#x27;.navigation-items-toggle, .navigation-subitems-toggle&#x27;);
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.toggleSections.bind(this), &#x27;.section-toggle&#x27;);
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.settingsClicked.bind(this), &#x27;.js-navigation-settings&#x27;);
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.selectSubItem.bind(this), &#x27;.js-navigation-sub-item, .js-navigation-item&#x27;);
        },

        /**
         * event listener
         */
        bindCustomEvents: function() {
            // change footer template
            this.sandbox.on(&#x27;husky.navigation.footer.set&#x27;, function(template) {
                this.options.footerTemplate = template;
                this.renderFooter(template);
            }.bind(this));

        },


        preselectItem: function() {
            if (!this.options.selectAction || this.options.selectAction.length &lt; 1) {
                return;
            }

            var matchLength = 0, matchItem, parent, match;
            this.sandbox.util.foreach(this.items, function(item) {
                if (!item || !item.action) {
                    return;
                }
                if (this.options.selectAction.indexOf(item.action) !== -1 &amp;&amp; item.action.length &gt; matchLength) {
                    matchItem = item;
                    matchLength = item.action.length;
                }
            }.bind(this));

            if (matchLength &gt; 0) {
                match = matchItem.domObject;

                // TODO: use trigger instead of faking event
                if (this.sandbox.dom.hasClass(match,&#x27;js-navigation-sub-item&#x27;)) {
                    parent = this.sandbox.dom.closest(match, &#x27;.navigation-items&#x27;);
                    this.toggleItems({currentTarget: parent, preventDefault: function(){}});
//                    this.sandbox.dom.trigger(parent, &#x27;click&#x27;,&#x27;.section-toggle&#x27;);
                }
                this.selectSubItem({currentTarget: match, preventDefault:function(){}});
            }
        },



        /**
         * gets called when settings icon is clicked
         * @emits husky.navigation.item.settings (name, id, parent)
         * @param event
         */
        settingsClicked: function(event) {

            event.stopPropagation();
            event.preventDefault();

            // emit event
            var listItem = this.sandbox.dom.closest(event.currentTarget, &#x27;.js-navigation-items&#x27;),
                item = this.items[this.sandbox.dom.data(listItem, &#x27;id&#x27;)];

            this.sandbox.emit(&#x27;husky.navigation.item.settings&#x27;, item);

        },

        /**
         * Toggles menu element with submenu
         * Raises navigation.toggle
         * @param event
         */
        toggleItems: function(event) {

            event.preventDefault();

            var $items = this.sandbox.dom.closest(event.currentTarget, &#x27;.js-navigation-items&#x27;),
                item, xBottom, windowHeight, itemHeight, itemTop,
                $toggle,

                $childList = this.sandbox.dom.find(&#x27;ul:first&#x27;, $items),
                isExpanded = this.sandbox.dom.hasClass($items, &#x27;is-expanded&#x27;);


            if (isExpanded) {
                this.sandbox.dom.slideUp($childList, 200, function() {

                    this.sandbox.dom.removeClass($items, &#x27;is-expanded&#x27;);

                    // change toggle item
                    $toggle = this.sandbox.dom.find(&#x27;.icon-chevron-down&#x27;, event.currentTarget);
                    this.sandbox.dom.removeClass($toggle, &#x27;icon-chevron-down&#x27;);
                    this.sandbox.dom.prependClass($toggle, &#x27;icon-chevron-right&#x27;);

                }.bind(this));
            } else {
                this.sandbox.dom.addClass($items, &#x27;is-expanded&#x27;);
                // change toggle item
                $toggle = this.sandbox.dom.find(&#x27;.icon-chevron-right&#x27;, event.currentTarget);
                this.sandbox.dom.removeClass($toggle, &#x27;icon-chevron-right&#x27;);
                this.sandbox.dom.prependClass($toggle, &#x27;icon-chevron-down&#x27;);

                this.sandbox.dom.slideDown($childList, 200, function() {


                    // check if collapsed element overlaps browser border
                    itemTop = this.sandbox.dom.offset($items).top;
                    itemHeight = this.sandbox.dom.height($items);
                    xBottom = itemTop + itemHeight;
                    windowHeight = this.sandbox.dom.height(this.sandbox.dom.window);
                    if (xBottom &gt; windowHeight) {
                        if (itemHeight &lt; windowHeight) {
                            this.sandbox.dom.scrollAnimate((xBottom - windowHeight + 40), &#x27;.navigation-container&#x27;);
                        } else {
                            this.sandbox.dom.scrollAnimate(itemTop, &#x27;.navigation-container&#x27;);
                        }
                    }
                }.bind(this));
            }

            // emit event
            item = this.items[this.sandbox.dom.data($items, &#x27;id&#x27;)];
            this.sandbox.emit(&#x27;husky.navigation.item.toggle&#x27;, !isExpanded, item);
        },


        /**
         * toggles sections
         * @param event
         */
        toggleSections: function(event) {

            event.preventDefault();

            var $section = this.sandbox.dom.closest(event.currentTarget, &#x27;.section&#x27;),
                $list = this.sandbox.dom.find(&#x27;.section-items&#x27;, $section),
                toggleLink = this.sandbox.dom.find(&#x27;a&#x27;, event.currentTarget);


            if (this.sandbox.dom.hasClass($section, &#x27;is-hidden&#x27;)) {
                // hide section
                this.sandbox.dom.slideDown($list, 200, function() {
                    this.sandbox.dom.html(toggleLink, this.sandbox.translate(this.options.labels.hide));
                    this.sandbox.dom.removeClass($section, &#x27;is-hidden&#x27;);
                }.bind(this));
            } else {
                // show section
                this.sandbox.dom.html(toggleLink, this.sandbox.translate(this.options.labels.show));
                this.sandbox.dom.slideUp($list, 200, function() {
                    this.sandbox.dom.addClass($section, &#x27;is-hidden&#x27;);
                }.bind(this));
            }

            this.sandbox.emit(&#x27;husky.navigation.section.toggle&#x27;);
        },

        /**
         * Selects menu element without submenu
         * Raises navigation.select
         * @param event
         */
        selectSubItem: function(event) {

            event.preventDefault();

            var $subItem = this.sandbox.dom.createElement(event.currentTarget),
                $items = this.sandbox.dom.parents(event.currentTarget, &#x27;.js-navigation-items&#x27;),
                $parent = this.sandbox.dom.parent(event.currentTarget),
                item;

            if (this.sandbox.dom.hasClass($subItem, &#x27;js-navigation-item&#x27;)) {
                $subItem = this.sandbox.dom.createElement(this.sandbox.dom.closest(event.currentTarget, &#x27;li&#x27;));
            }

            // if toggle was clicked, do not set active and selected
            if (this.sandbox.dom.hasClass($parent, &#x27;navigation-items-toggle&#x27;) || this.sandbox.dom.hasClass($parent, &#x27;navigation-subitems-toggle&#x27;)) {
                return;
            }

            this.sandbox.dom.removeClass(this.sandbox.dom.find(&#x27;.is-selected&#x27;, this.$el), &#x27;is-selected&#x27;);
            this.sandbox.dom.addClass($subItem, &#x27;is-selected&#x27;);

            this.sandbox.dom.removeClass(this.sandbox.dom.find(&#x27;.is-active&#x27;, this.$el), &#x27;is-active&#x27;);
            this.sandbox.dom.addClass($items, &#x27;is-active&#x27;);


            // emit event
            item = this.items[this.sandbox.dom.data($subItem, &#x27;id&#x27;)];
            this.sandbox.emit(&#x27;husky.navigation.item.select&#x27;, item);
        }

    };

});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
